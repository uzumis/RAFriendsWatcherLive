<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Achievement Watcher</title>
</head>
<link rel="stylesheet" href="./css/index.css">

<body>
    <script>
        // Função para buscar os áudios customizados do backend
        async function getCustomAudioPaths() {
            try {
                const res = await fetch('/customaudio');
                if (!res.ok) throw new Error('Erro ao buscar customaudio');
                return await res.json();
            } catch (e) {
                return {};
            }
        }
        // Caminho padrão único para todos os sons
        const DEFAULT_SOUNDS = {
            achievement: './som/chievosound.mp3',
            chocolateBranco: './som/chievosound.mp3',
            specialAchievement: './som/chievosound.mp3',
            superAchievement: './som/chievosound.mp3',
            platinum: './som/chievosound.mp3'
        };
    </script>
    <audio id="achievement-sound" src=""></audio>
    <audio id="chocolate-branco" src=""></audio>
    <audio id="special-achievement" src=""></audio>
    <audio id="fifty" src=""></audio>
    <audio id="platinum-sound" src=""></audio>

    <div id="achievement-popup">
        <div id="chievo-wrapper" style="display: flex; flex-direction: column; gap: 16px;">
            <div style="display: flex; align-items: center; gap: 16px;">
                <div id="chievo-player">

                </div>
                <img src="" alt="Foto do usuário" id="userPhoto"
                    style="width: 96px; height: 96px; border-radius: 50%; box-shadow: 0 2px 16px rgba(0, 0, 0, 0.35);">

            </div>
            <!-- Linha superior: Foto do usuário e título -->
            <div style="display: flex; align-items: center; gap: 16px;">

                <span id="conquista-titulo" class="achievement-title" style="flex: 1;"></span>
            </div>

            <!-- Linha inferior: Foto da conquista e descrição -->
            <div style="display: flex; align-items: center; gap: 16px;">
                <img id="achievement-icon" src="" alt="Ícone da conquista"
                    style="width: 128px; height: 128px; border-radius: 8px; box-shadow: 0 2px 16px rgba(0, 0, 0, 0.35);">
                <div class="achievement__container" style="flex: 1;">
                    <span id="achievement-text" class="achievement-game"></span>
                    <!-- <span id="achievement-description" class="achievement-desc"></span> -->
                    <!-- <span id="date" class="achievement-date"></span> -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Aplica os caminhos aos elementos de áudio assim que o DOM estiver pronto
        document.addEventListener('DOMContentLoaded', async function() {
            const custom = await getCustomAudioPaths();
            function resolveAudioPath(val, def, tipo) {
                if (!val || typeof val !== 'string' || val.trim() === '') {
                    console.log(`[AUDIO] Usando padrão para ${tipo}:`, def);
                    return def;
                }
                // Se for só o nome do arquivo, monta o caminho
                if (!val.startsWith('./') && !val.startsWith('/')) {
                    console.log(`[AUDIO] Usando customizado para ${tipo}: ./som/${val}`);
                    return './som/' + val;
                }
                console.log(`[AUDIO] Usando customizado para ${tipo}:`, val);
                return val;
            }
            document.getElementById('achievement-sound').src = resolveAudioPath(custom.achievement, DEFAULT_SOUNDS.achievement, 'achievement');
            document.getElementById('chocolate-branco').src = resolveAudioPath(custom.chocolateBranco, DEFAULT_SOUNDS.chocolateBranco, 'chocolateBranco');
            document.getElementById('special-achievement').src = resolveAudioPath(custom.specialAchievement, DEFAULT_SOUNDS.specialAchievement, 'specialAchievement');
            document.getElementById('fifty').src = resolveAudioPath(custom.superAchievement, DEFAULT_SOUNDS.superAchievement, 'superAchievement');
            document.getElementById('platinum-sound').src = resolveAudioPath(custom.platinum, DEFAULT_SOUNDS.platinum, 'platinum');
        });
    </script>
<script type="module" src="./API/frontJs.js"></script>
</body>

</html>